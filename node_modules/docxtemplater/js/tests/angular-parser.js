"use strict";

var expressions = require("angular-expressions");

var merge = require("lodash/merge");

function angularParser(tag) {
  if (tag === ".") {
    return {
      get: function get(s) {
        return s;
      }
    };
  }

  var expr = expressions.compile(tag.replace(/(’|‘)/g, "'").replace(/(“|”)/g, '"'));
  return {
    get: function get(scope, context) {
      var obj = {};
      var scopeList = context.scopeList;
      var num = context.num;

      for (var i = 0, len = num + 1; i < len; i++) {
        obj = merge(obj, scopeList[i]);
      }

      return expr(scope, obj);
    }
  };
}

module.exports = angularParser;